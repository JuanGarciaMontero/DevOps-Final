pipeline {
    agent any
    stages {
        stage('Stage crea contenedor con Python') {
            agent {
                docker { image 'python:slim-bullseye' }
            }
            steps {
                echo 'Stage con ejecuci√≥n normal, python'
                sh 'python --version'
                sh 'echo $HOME'
                sh 'echo "Current directory: $(pwd)"'
                sh 'echo "Contents of $HOME/.cache/pip:"'
                sh 'ls -la $HOME//.cache/pip'
                sh '. ./env/bin/activate && chmod -R u+w $HOME//.cache/pip && pip install pytest==6.2.5 && pytest tests/'
                sh 'pip install coverage'
                sh 'pytest --cov=app tests/'
            }
        }
    }
    post {
        always {
            echo "Fin del pipeline"
        }
    }
}
